groups:
  - name: basefaq-rabbitmq
    rules:
      - alert: RabbitMqUnavailable
        expr: max_over_time(rabbitmq_up[2m]) < 1
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: RabbitMQ exporter cannot reach RabbitMQ
          description: RabbitMQ exporter has reported rabbitmq_up=0 for at least 2 minutes.

      - alert: RabbitMqQueueLagHigh
        expr: sum(rabbitmq_queue_messages_ready) > 500
        for: 10m
        labels:
          severity: warning
        annotations:
          summary: Queue lag is above threshold
          description: Total ready messages across queues is above 500 for 10 minutes.

      - alert: RabbitMqDlqGrowth
        expr: sum(increase(rabbitmq_queue_messages_ready{queue=~"(?i).*(dlq|dead).*"}[15m])) > 50
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: DLQ growth detected
          description: Dead-letter queue messages increased by more than 50 in the last 15 minutes.

      - alert: RabbitMqQueueNoConsumers
        expr: max by (queue, vhost) ((rabbitmq_queue_messages_ready{queue!~"(?i).*(dlq|dead).*"} > 100) and on(queue, vhost, instance) (rabbitmq_queue_consumers{queue!~"(?i).*(dlq|dead).*"} == 0)) > 0
        for: 10m
        labels:
          severity: warning
        annotations:
          summary: Queue has messages but no consumers
          description: At least one non-DLQ queue has more than 100 ready messages and zero consumers for 10 minutes.
